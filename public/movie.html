<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Details ‚Äî CineVerse Analytics</title>
    <meta name="description" content="View detailed movie information including box office performance, cast, reviews, and ratings">
    <meta name="keywords" content="movie details, box office, movie ratings, film information, cinema data">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://cineverse.com/movie.html">
    <meta property="og:title" content="Movie Details ‚Äî CineVerse Analytics">
    <meta property="og:description" content="View detailed movie information including box office performance, cast, reviews, and ratings">
    <meta property="og:image" content="https://cineverse.com/images/og-image.jpg">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Movie Details ‚Äî CineVerse Analytics">
    <meta name="twitter:description" content="View detailed movie information including box office performance, cast, reviews, and ratings">
    <meta name="twitter:image" content="https://cineverse.com/images/og-image.jpg">
    
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé¨</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/seo-helper.js"></script>
</head>
<body>
    <div class="animated-bg"></div>
    <div class="scroll-progress" id="scroll-progress"></div>
    
    <nav class="navbar">
        <div class="logo">üé¨ CineVerse</div>
        <ul class="nav-links">
            <li><a href="index.html">üé¨ Home</a></li>
            <li><a href="movies.html">üéûÔ∏è All Movies</a></li>
            <li><a href="hollywood.html">üåç Hollywood</a></li>
            <li><a href="bollywood.html">üé• Bollywood</a></li>
            <li><a href="tollywood.html">üé≠ Tollywood</a></li>
            <li><a href="top10.html">üèÖ Top 10</a></li>
            <li><a href="analytics.html">üìä Analytics</a></li>
            <li><a href="compare.html">‚öñÔ∏è Compare</a></li>
            <li><a href="about.html">‚ÑπÔ∏è About</a></li>
            <li><a href="contact.html">üíå Contact</a></li>
        </ul>
        <button class="theme-toggle" id="theme-toggle">üåô</button>
    </nav>

    <div class="movie-details" id="movie-details">
        <!-- Movie details will be loaded here -->
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p style="font-size: 0.75rem; line-height: 1.5; margin: 0;">Your Ultimate Box Office Analytics Platform | ¬© 2025 CineVerse Analytics | Developed by Mohammad Aakib Bhat</p>
        </div>
    </footer>

    <!-- Scroll to Top Button -->
    <button id="scroll-to-top" class="scroll-to-top" title="Scroll to top">‚Üë</button>

    <script src="js/api.js"></script>
    <script src="js/main.js"></script>
    <script>
        async function loadMovieDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const movieId = urlParams.get('id');
            
            if (!movieId) {
                document.getElementById('movie-details').innerHTML = '<h1 style="text-align: center; padding: 4rem; color: var(--text);">Movie not found</h1>';
                return;
            }

            try {
                const movie = await fetchMovieById(movieId);
                if (!movie) {
                    document.getElementById('movie-details').innerHTML = '<h1 style="text-align: center; padding: 4rem; color: var(--text);">Movie not found</h1>';
                    return;
                }

                const currency = getCurrency();
                const container = document.getElementById('movie-details');
                const imdbRating = movie.imdb_rating || 0;
                const stars = '‚≠ê'.repeat(Math.floor(imdbRating));
                
                container.innerHTML = `
                    <div class="movie-header">
                        <div class="movie-header-poster">
                            <img src="${getPosterURL(movie)}" alt="${movie.title}" onerror="this.src='https://via.placeholder.com/300x450?text=No+Poster'">
                            <button class="btn btn-primary" style="margin-top: 1rem; width: 100%;" onclick="toggleFavorite(${movie.id})" id="favorite-btn">
                                ‚ù§Ô∏è Add to Favorites
                            </button>
                        </div>
                        <div class="movie-header-info">
                            <h1>${movie.title} (${movie.year})</h1>
                            ${imdbRating > 0 ? `<div style="margin: 1rem 0; font-size: 1.2rem;"><span style="color: #ffd700;">${stars}</span> <span>${imdbRating}/10</span></div>` : ''}
                            
                            <!-- Tabs -->
                            <div class="movie-tabs">
                                <button class="tab-btn active" onclick="switchTab('overview', this)">üìù Overview</button>
                                <button class="tab-btn" onclick="switchTab('cast', this)">üë• Cast</button>
                                <button class="tab-btn" onclick="switchTab('boxoffice', this)">üí∞ Box Office</button>
                                <button class="tab-btn" onclick="switchTab('reviews', this)">‚≠ê Reviews</button>
                                <button class="tab-btn" onclick="switchTab('awards', this)">üèÜ Awards</button>
                            </div>

                            <!-- Tab Content -->
                            <div class="tab-content" id="overview-tab">
                                <p style="font-size: 1.1rem; opacity: 0.9; margin-bottom: 1.5rem; color: var(--text-secondary); line-height: 1.8;">${movie.description || 'No description available.'}</p>
                                
                                <div class="movie-meta">
                                    <div class="meta-item">
                                        <div class="meta-label">Director</div>
                                        <div class="meta-value">${movie.director || 'N/A'}</div>
                                    </div>
                                    <div class="meta-item">
                                        <div class="meta-label">Category</div>
                                        <div class="meta-value">${movie.category}</div>
                                    </div>
                                    <div class="meta-item">
                                        <div class="meta-label">Genre</div>
                                        <div class="meta-value">${getGenresString(movie)}</div>
                                    </div>
                                    <div class="meta-item">
                                        <div class="meta-label">Language</div>
                                        <div class="meta-value">${movie.language || 'N/A'}</div>
                                    </div>
                                    <div class="meta-item">
                                        <div class="meta-label">Runtime</div>
                                        <div class="meta-value">${movie.runtime || 'N/A'}</div>
                                    </div>
                                    <div class="meta-item">
                                        <div class="meta-label">Release Date</div>
                                        <div class="meta-value">${formatDate(getReleaseDate(movie))}</div>
                                    </div>
                                </div>

                                ${movie.source_urls && movie.source_urls.length > 0 ? `
                                    <div style="margin-top: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                                        ${movie.source_urls.map((url, idx) => {
                                            const label = url.includes('imdb') ? 'üé¨ IMDb' : url.includes('boxoffice') ? 'üìä BoxOfficeMojo' : url.includes('wikipedia') ? 'üìö Wikipedia' : 'üîó Source';
                                            return `<a href="${url}" target="_blank" class="btn btn-secondary" style="font-size: 0.9rem; padding: 0.5rem 1rem;">${label}</a>`;
                                        }).join('')}
                                    </div>
                                ` : ''}
                            </div>

                            <div class="tab-content" id="cast-tab" style="display: none;">
                                <h3 style="margin-bottom: 1rem; color: var(--text);">Cast & Crew</h3>
                                ${movie.cast ? `
                                    <div style="background: var(--glass-bg); backdrop-filter: blur(20px); padding: 1.5rem; border-radius: 15px; border: 1px solid var(--glass-border);">
                                        <p style="color: var(--text-secondary); line-height: 1.8;">${movie.cast}</p>
                                    </div>
                                ` : '<p style="color: var(--text-secondary);">Cast information not available.</p>'}
                                ${movie.director ? `
                                    <div style="margin-top: 1.5rem;">
                                        <h4 style="color: var(--neon-blue); margin-bottom: 0.5rem;">Director</h4>
                                        <p style="color: var(--text); font-size: 1.1rem;">${movie.director}</p>
                                    </div>
                                ` : ''}
                            </div>

                            <div class="tab-content" id="boxoffice-tab" style="display: none;">
                                <h3 style="margin-bottom: 1.5rem; color: var(--text);">Box Office Performance</h3>
                                <div class="earnings-detailed">
                                    <div class="earning-card">
                                        <div class="earning-label">Domestic Gross (${currency})</div>
                                        <div class="earning-amount">${formatCurrency(currency === 'USD' ? (movie.domestic_gross_usd || 0) : (movie.domestic_gross_inr || 0), currency)}</div>
                                    </div>
                                    <div class="earning-card">
                                        <div class="earning-label">International Gross (${currency})</div>
                                        <div class="earning-amount">${formatCurrency(currency === 'USD' ? (movie.worldwide_gross_usd - (movie.domestic_gross_usd || 0)) : (movie.worldwide_gross_inr - (movie.domestic_gross_inr || 0)), currency)}</div>
                                    </div>
                                    <div class="earning-card">
                                        <div class="earning-label">Worldwide Gross (${currency})</div>
                                        <div class="earning-amount">${formatCurrency(getGrossAmount(movie, currency), currency)}</div>
                                    </div>
                                    ${(movie.budget_usd || movie.budget_inr) ? `
                                        <div class="earning-card">
                                            <div class="earning-label">Budget (${currency})</div>
                                            <div class="earning-amount">${formatCurrency(currency === 'USD' ? (movie.budget_usd || 0) : (movie.budget_inr || (movie.budget_usd || 0) * 83), currency)}</div>
                                        </div>
                                    ` : ''}
                                    ${(movie.profit_inr || (movie.worldwide_gross_usd && movie.budget_usd)) ? `
                                        <div class="earning-card">
                                            <div class="earning-label">Profit (${currency})</div>
                                            <div class="earning-amount" style="color: #4ade80;">${formatCurrency(currency === 'USD' ? ((movie.worldwide_gross_usd || 0) - (movie.budget_usd || 0)) : (movie.profit_inr || ((movie.worldwide_gross_usd || 0) - (movie.budget_usd || 0)) * 83), currency)}</div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>

                            <div class="tab-content" id="reviews-tab" style="display: none;">
                                <h3 style="margin-bottom: 1.5rem; color: var(--text);">Reviews & Ratings</h3>
                                <div style="background: var(--glass-bg); backdrop-filter: blur(20px); padding: 2rem; border-radius: 15px; border: 1px solid var(--glass-border);">
                                    ${imdbRating > 0 ? `
                                        <div style="margin-bottom: 1.5rem;">
                                            <h4 style="color: var(--neon-blue); margin-bottom: 0.5rem;">IMDb Rating</h4>
                                            <div style="font-size: 2rem;">
                                                <span style="color: #ffd700;">${stars}</span>
                                                <span style="font-size: 1.5rem; margin-left: 0.5rem;">${imdbRating}/10</span>
                                            </div>
                                        </div>
                                    ` : ''}
                                    <div id="user-reviews-section">
                                        <h4 style="color: var(--neon-blue); margin-bottom: 1rem;">User Reviews</h4>
                                        <div id="user-reviews-list">
                                            <p style="color: var(--text-secondary);">No user reviews yet. Be the first to review!</p>
                                        </div>
                                        <div style="margin-top: 1.5rem;">
                                            <textarea id="review-text" placeholder="Write your review..." style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); border-radius: 10px; color: var(--text); min-height: 100px; margin-bottom: 1rem;"></textarea>
                                            <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem;">
                                                <label style="color: var(--text-secondary);">Rating:</label>
                                                <select id="review-rating" style="padding: 0.5rem; background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); border-radius: 5px; color: var(--text);">
                                                    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                                                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
                                                    <option value="3">‚≠ê‚≠ê‚≠ê</option>
                                                    <option value="2">‚≠ê‚≠ê</option>
                                                    <option value="1">‚≠ê</option>
                                                </select>
                                            </div>
                                            <button class="btn btn-primary" onclick="submitReview(${movie.id})">Submit Review</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-content" id="awards-tab" style="display: none;">
                                <h3 style="margin-bottom: 1.5rem; color: var(--text);">Awards & Nominations</h3>
                                <div style="background: var(--glass-bg); backdrop-filter: blur(20px); padding: 2rem; border-radius: 15px; border: 1px solid var(--glass-border);">
                                    ${movie.awards ? `
                                        <p style="color: var(--text-secondary); line-height: 1.8; font-size: 1.1rem;">${movie.awards}</p>
                                    ` : `
                                        <p style="color: var(--text-secondary);">Awards information not available.</p>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>

                    ${getTrailerURL(movie) ? `
                        <div style="margin: 3rem 0;">
                            <h2 style="margin-bottom: 1.5rem; font-family: 'Orbitron', sans-serif; color: var(--text);">üé• Official Trailer</h2>
                            <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 15px;">
                                <iframe 
                                    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                                    src="${getTrailerURL(movie)}" 
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    ` : ''}

                    <div style="margin: 3rem 0;">
                        <h2 style="margin-bottom: 1.5rem; font-family: 'Orbitron', sans-serif; color: var(--text);">üìä Earnings Comparison</h2>
                        <canvas id="earningsChart" style="max-height: 400px;"></canvas>
                    </div>

                    <div style="margin: 3rem 0;">
                        <h2 style="margin-bottom: 1.5rem; font-family: 'Orbitron', sans-serif; color: var(--text);">üé¨ Similar Movies</h2>
                        <div id="similar-movies" class="movies-grid">
                            <!-- Similar movies will be loaded -->
                        </div>
                    </div>
                `;

                // Load chart
                loadEarningsChart(movie, currency);
                
                // Load similar movies
                loadSimilarMovies(movie);
                
                // Check favorite status
                checkFavoriteStatus(movie.id);
                
                // Load user reviews
                setTimeout(() => loadUserReviews(movie.id), 100);

            } catch (error) {
                console.error('Error loading movie:', error);
                document.getElementById('movie-details').innerHTML = '<h1 style="text-align: center; padding: 4rem; color: var(--text);">Error loading movie details</h1>';
            }
        }

        function loadEarningsChart(movie, currency) {
            const ctx = document.getElementById('earningsChart').getContext('2d');
            const domestic = currency === 'USD' ? (movie.domestic_gross_usd || 0) : (movie.domestic_gross_inr || 0);
            const international = currency === 'USD' ? 
                ((movie.worldwide_gross_usd || 0) - (movie.domestic_gross_usd || 0)) : 
                ((movie.worldwide_gross_inr || 0) - (movie.domestic_gross_inr || 0));
            const worldwide = getGrossAmount(movie, currency);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Domestic', 'International', 'Worldwide'],
                    datasets: [{
                        label: `Earnings (${currency})`,
                        data: [domestic, international, worldwide],
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(255, 107, 107, 0.8)',
                            'rgba(74, 222, 128, 0.8)'
                        ],
                        borderColor: [
                            'rgba(102, 126, 234, 1)',
                            'rgba(255, 107, 107, 1)',
                            'rgba(74, 222, 128, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'var(--text)'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: 'var(--text)',
                                callback: function(value) {
                                    if (currency === 'USD') {
                                        return '$' + (value / 1000000).toFixed(1) + 'M';
                                    }
                                    return '‚Çπ' + (value / 10000000).toFixed(1) + 'Cr';
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'var(--text)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        async function loadSimilarMovies(movie) {
            try {
                const allMovies = await fetchMovies();
                const similar = allMovies
                    .filter(m => m.id !== movie.id && (m.category === movie.category || getGenresString(m).split(',')[0].trim() === getGenresString(movie).split(',')[0].trim()))
                    .slice(0, 4);
                
                const container = document.getElementById('similar-movies');
                if (similar.length === 0) {
                    container.innerHTML = '<p style="text-align: center; opacity: 0.7; color: var(--text-secondary);">No similar movies found.</p>';
                    return;
                }

                const currency = getCurrency();
                container.innerHTML = similar.map(m => {
                    const gross = getGrossAmount(m, currency);
                    const formattedGross = formatCurrency(gross, currency);
                    return `
                        <div class="movie-card" onclick="window.location.href='movie.html?id=${m.id}'">
                            <img src="${getPosterURL(m)}" alt="${m.title}" class="movie-poster" onerror="this.src='https://via.placeholder.com/300x400?text=No+Poster'">
                            <div class="movie-info">
                                <h3 class="movie-title">${m.title}</h3>
                                <div class="movie-year">${m.year} ‚Ä¢ ${m.category}</div>
                                <div class="movie-gross">${formattedGross}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading similar movies:', error);
            }
        }

        function toggleFavorite(movieId) {
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const index = favorites.indexOf(movieId);
            
            if (index > -1) {
                favorites.splice(index, 1);
                document.getElementById('favorite-btn').textContent = '‚ù§Ô∏è Add to Favorites';
            } else {
                favorites.push(movieId);
                document.getElementById('favorite-btn').textContent = 'üíî Remove from Favorites';
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        function checkFavoriteStatus(movieId) {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            if (favorites.includes(movieId)) {
                document.getElementById('favorite-btn').textContent = 'üíî Remove from Favorites';
            }
        }

        // Tab switching functionality
        function switchTab(tabName, buttonElement) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').style.display = 'block';
            buttonElement.classList.add('active');
        }

        // Submit review functionality
        function submitReview(movieId) {
            const reviewText = document.getElementById('review-text').value;
            const rating = document.getElementById('review-rating').value;
            
            if (!reviewText.trim()) {
                alert('Please write a review');
                return;
            }
            
            // Get existing reviews from localStorage
            let reviews = JSON.parse(localStorage.getItem(`reviews_${movieId}`) || '[]');
            
            const newReview = {
                id: reviews.length + 1,
                text: reviewText,
                rating: parseInt(rating),
                date: new Date().toLocaleDateString(),
                timestamp: Date.now()
            };
            
            reviews.push(newReview);
            localStorage.setItem(`reviews_${movieId}`, JSON.stringify(reviews));
            
            // Update reviews display
            loadUserReviews(movieId);
            
            // Clear form
            document.getElementById('review-text').value = '';
            document.getElementById('review-rating').value = '5';
            
            alert('Review submitted successfully!');
        }

        // Load user reviews
        function loadUserReviews(movieId) {
            const reviews = JSON.parse(localStorage.getItem(`reviews_${movieId}`) || '[]');
            const container = document.getElementById('user-reviews-list');
            
            if (reviews.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No user reviews yet. Be the first to review!</p>';
                return;
            }
            
            container.innerHTML = reviews.map(review => `
                <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 10px; margin-bottom: 1rem; border-left: 3px solid var(--neon-blue);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <div style="color: #ffd700;">${'‚≠ê'.repeat(review.rating)}</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">${review.date}</div>
                    </div>
                    <p style="color: var(--text); line-height: 1.6;">${review.text}</p>
                </div>
            `).join('');
        }

    </script>
</body>
</html>
